[gd_scene load_steps=57 format=3 uid="uid://jennwsxj6p05"]

[ext_resource type="Script" path="res://scripts/bomb.gd" id="1"]
[ext_resource type="Script" path="res://scripts/grabbable.gd" id="2"]
[ext_resource type="Script" path="res://res_inputprompt.gd" id="3"]
[ext_resource type="Script" path="res://scripts/hitbox.gd" id="4"]
[ext_resource type="Script" path="res://scripts/state_machine.gd" id="5"]
[ext_resource type="AudioStream" uid="uid://bcy15eovkrtad" path="res://audio/sfx/bomb_fuse.wav" id="6"]
[ext_resource type="AudioStream" uid="uid://c0olujlsooivk" path="res://audio/sfx/bomb_lit.wav" id="7"]
[ext_resource type="AudioStream" uid="uid://b4671f6h87u71" path="res://audio/sfx/bomb_whistle.wav" id="8"]
[ext_resource type="AudioStream" uid="uid://bevipth3tferk" path="res://audio/sfx/beep.wav" id="9"]
[ext_resource type="AudioStream" uid="uid://b5ekvensla76" path="res://audio/sfx/explosion_1.wav" id="10"]
[ext_resource type="AudioStream" uid="uid://yrykx20quxxd" path="res://audio/sfx/explosion_2.wav" id="11"]
[ext_resource type="PackedScene" uid="uid://cy6ivbjoqluq" path="res://asset/entity/bomb/bomb.blend" id="12"]
[ext_resource type="Material" uid="uid://btypbvw2m85xk" path="res://asset/entity/bomb/mat/vtx_base.tres" id="13"]
[ext_resource type="Material" path="res://asset/effect/spark/vtx_spark.tres" id="14"]
[ext_resource type="Script" path="res://scripts/shadow.gd" id="15"]
[ext_resource type="Material" path="res://asset/effect/dust/mat/vtx_dust.tres" id="16"]
[ext_resource type="Texture2D" uid="uid://2rug74yexel0" path="res://asset/effect/dust/dust_cloud.png" id="17"]

[sub_resource type="CylinderShape3D" id="1"]
height = 2.61637
radius = 1.66513

[sub_resource type="Resource" id="2"]
script = ExtResource("3")
input = Array[StringName]([&"interact"])
render_as_analog = false
equip_icon = 0
message = "to Interact"

[sub_resource type="CylinderShape3D" id="3"]
height = 6.0
radius = 4.0

[sub_resource type="CylinderShape3D" id="4"]
height = 10.0
radius = 6.5

[sub_resource type="GDScript" id="5"]
resource_name = "bomb_idle"
script/source = "# bomb_idle.gd
extends State

'''
Bomb => Idle state
'''

@onready var bomb := owner as Entity

func _enter(_msg := {}) -> void:
	# Make material unique
	var b_base = bomb.get_node(\"vis_bomb/base\") as MeshInstance3D
	b_base.set_surface_override_material(0, b_base.get_surface_override_material(0).duplicate())
	# See if bomb is automatically fused
	if bomb.start_as_fuming:
		state_machine.transition_state(\"fuming\")
		return
	
	# Animate bomb
	bomb.set_anim(\"idle\")

func _state_physics_process(delta : float) -> void:
	bomb.update_movement(delta)

func _exit() -> void:
	pass

# FUNCTION
#-------------------------------------------------------------------------------

func _grabbable_interacted_with() -> void:
	# Abort if not in idle state
	if state_machine.state != self:
		return
	
	# Stop processing physics
	var col := bomb.get_node(\"col\") as CollisionShape3D
	var grabbable := bomb.get_node(\"grabbable\") as Grabbable
	col.disabled = true
	grabbable.process_mode = Node.PROCESS_MODE_DISABLED
	
	# Set state to fuming
	state_machine.transition_state(\"fuming\", {\"physics\" : false})
"

[sub_resource type="GDScript" id="6"]
resource_name = "bomb_fuming"
script/source = "# bomb_fuming.gd
extends State

'''
Bomb => Fuming state
'''

@onready var bomb := owner as Entity
@onready var fuse_time := $fuse_time as Timer

var process_physics := true
var explode_on_contact := true

func _enter(_msg := {}) -> void:
	# Set bomb animation
	bomb.change_anim(\"fuming\")
	bomb.get_node(\"sfx/strike\").play()
	bomb.get_node(\"sfx/fuse\").play()
	
	# Get process type
	process_physics = _msg.get(\"physics\", true)
	explode_on_contact = _msg.get(\"explode\", true)
	
	# Play sfx if processing physics
	if process_physics:
		bomb.get_node(\"sfx/whistle\").play()
	
	# Begin timer
	fuse_time.wait_time = bomb.fuse_time
	fuse_time.start()
	
	# Loop while fuse_time is going
	while !fuse_time.is_stopped():
		# Update animation
		bomb.anim_tree.set(
			\"parameters/fuming/speed/scale\",
			minf(fuse_time.wait_time / fuse_time.time_left, 4)
		)
		
		# Wait a physics frame
		await get_tree().physics_frame

func _state_physics_process(delta : float) -> void:
	# Divert if necessary
	if !process_physics:
		return
	
	# Update physics
	bomb.update_movement(delta)
	bomb.forward_speed = bomb.ease_value(bomb.forward_speed, 0, bomb.deacceleration, delta)
	
	# Stop sfx if on ground
	if bomb.is_on_floor() && bomb.get_node(\"sfx/whistle\").playing:
		bomb.get_node(\"sfx/whistle\").stop()
	
	# Check to see if on ground or wall
	if (bomb.is_on_floor() || bomb.is_on_wall()) && explode_on_contact:
		fuse_time.stop()
		state_machine.transition_state(\"explode\")
		return
	elif bomb.is_on_floor() && !explode_on_contact:
		bomb.forward_speed = bomb.ease_value(bomb.forward_speed, 0, bomb.deacceleration, delta)

func _exit() -> void:
	bomb.get_node(\"sfx/fuse\").stop()

# FUNCTION
#-------------------------------------------------------------------------------

func _fuse_timeout() -> void:
	# Get and set player states
	var lm := get_tree().current_scene.level_manager as LevelManager
	var p := lm.player as Player
	if p && !process_physics: 
		p._equip_manager.current_equipment.transition_state(\"none\")
	
	# Wait a frame
	await get_tree().process_frame
	
	# Explosion time
	state_machine.transition_state(\"explode\")

func _thrown() -> void:
	# Verify state
	if state_machine.state != self:
		return
	
	# Stop fuse timer
	fuse_time.stop()
	
	# Set explode
	explode_on_contact = true
	
	# Start processing physics
	var col := bomb.get_node(\"col\") as CollisionShape3D
	col.disabled = false
	process_physics = true
	bomb.get_node(\"sfx/whistle\").play()

func _grabbable_interacted_with() -> void:
	# Verify this is the current state
	if state_machine.state != self:
		return
	
	# Stop processing physics again
	process_physics = false
	var col := bomb.get_node(\"col\") as CollisionShape3D
	var grabbable := bomb.get_node(\"grabbable\") as Grabbable
	col.disabled = true
	grabbable.process_mode = Node.PROCESS_MODE_DISABLED
"

[sub_resource type="GDScript" id="7"]
resource_name = "bomb_explode"
script/source = "# bomb_explode.gd
extends State

'''
Bomb => Explode state
'''

@onready var bomb := owner as Entity

func _enter(_msg := {}) -> void:
	# Play explosion anim
	bomb.set_anim(\"explode\")
	
	# Remove shadow
	bomb.get_node(\"shadow\").queue_free()

func _state_physics_process(delta : float) -> void:
	pass

func _exit() -> void:
	pass

"

[sub_resource type="AudioStreamRandomizer" id="8"]
random_pitch = 1.05
streams_count = 2
stream_0/stream = ExtResource("10")
stream_0/weight = 1.0
stream_1/stream = ExtResource("11")
stream_1/weight = 1.0

[sub_resource type="ParticleProcessMaterial" id="9"]
gravity = Vector3(0, 0, 0)
scale_min = 0.25
scale_max = 0.25
color = Color(1, 0.87451, 0.337255, 1)
anim_speed_min = 1.0
anim_speed_max = 1.0

[sub_resource type="ArrayMesh" id="10"]
_surfaces = [{
"aabb": AABB(-4, -4, -2.38419e-07, 8, 8, 1.04768e-05),
"format": 34896613377,
"index_count": 6,
"index_data": PackedByteArray(0, 0, 3, 0, 1, 0, 0, 0, 2, 0, 3, 0),
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 4,
"vertex_data": PackedByteArray(0, 0, 0, 0, 166, 11, 0, 0, 255, 255, 0, 0, 166, 11, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0)
}]
blend_shape_mode = 0

[sub_resource type="ArrayMesh" id="11"]
resource_name = "plane_padded_centered_Plane"
_surfaces = [{
"aabb": AABB(-4, -4, -2.38419e-07, 8, 8, 1.04768e-05),
"attribute_data": PackedByteArray(156, 5, 98, 250, 98, 250, 98, 250, 156, 5, 156, 5, 98, 250, 156, 5),
"format": 34896613399,
"index_count": 6,
"index_data": PackedByteArray(0, 0, 3, 0, 1, 0, 0, 0, 2, 0, 3, 0),
"material": ExtResource("14"),
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 4,
"vertex_data": PackedByteArray(0, 0, 0, 0, 166, 11, 255, 127, 255, 255, 0, 0, 166, 11, 255, 127, 0, 0, 255, 255, 0, 0, 255, 127, 255, 255, 255, 255, 0, 0, 255, 127, 255, 127, 255, 255, 255, 127, 255, 255, 255, 127, 255, 255, 255, 127, 255, 255)
}]
blend_shape_mode = 0
shadow_mesh = SubResource("10")

[sub_resource type="Animation" id="12"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("vis_bomb:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(1, 1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("vis_bomb/base:surface_material_override/0:shader_parameter/modulate_color")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("vis_bomb/stem/spark:emitting")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("sfx/explosion:playing")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("hitbox/col:disabled")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("vis_bomb:visible")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("particle/explosion:emitting")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("particle/smoke:emitting")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/8/type = "value"
tracks/8/imported = false
tracks/8/enabled = true
tracks/8/path = NodePath("sfx/beep:playing")
tracks/8/interp = 1
tracks/8/loop_wrap = true
tracks/8/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/9/type = "value"
tracks/9/imported = false
tracks/9/enabled = true
tracks/9/path = NodePath("col:disabled")
tracks/9/interp = 1
tracks/9/loop_wrap = true
tracks/9/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/10/type = "value"
tracks/10/imported = false
tracks/10/enabled = true
tracks/10/path = NodePath("grabbable/col:disabled")
tracks/10/interp = 1
tracks/10/loop_wrap = true
tracks/10/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="13"]
resource_name = "explode"
length = 2.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("sfx/explosion:playing")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("hitbox/col:disabled")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.6),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [false, true]
}
tracks/2/type = "method"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(2),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"queue_free"
}]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("vis_bomb:visible")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("particle/explosion:emitting")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("particle/smoke:emitting")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("col:disabled")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("grabbable/col:disabled")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="14"]
resource_name = "fuming"
loop_mode = 1
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("vis_bomb:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.25, 0.5, 0.75, 1),
"transitions": PackedFloat32Array(0.5, 2, 0.5, 2, 0.5),
"update": 0,
"values": [Vector3(0.8, 1.2, 0.8), Vector3(1.25, 0.75, 1.25), Vector3(0.8, 1.2, 0.8), Vector3(1.25, 0.75, 1.25), Vector3(0.8, 1.2, 0.8)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("vis_bomb/base:surface_material_override/0:shader_parameter/modulate_color")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.25, 0.5, 0.75, 1),
"transitions": PackedFloat32Array(0.5, 2, 0.5, 2, 1),
"update": 0,
"values": [Color(1, 0, 0, 1), Color(1, 1, 1, 1), Color(1, 0, 0, 1), Color(1, 1, 1, 1), Color(1, 0, 0, 1)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("vis_bomb/stem/spark:emitting")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [true, true]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("sfx/beep:playing")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.5),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, true]
}

[sub_resource type="Animation" id="15"]
resource_name = "idle"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("vis_bomb:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5, 1),
"transitions": PackedFloat32Array(0.5, 2, 0.5),
"update": 0,
"values": [Vector3(0.9, 1.1, 0.9), Vector3(1.25, 0.9, 1.25), Vector3(0.9, 1.1, 0.9)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("vis_bomb/stem/spark:emitting")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [false, false]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("vis_bomb/base:surface_material_override/0:shader_parameter/modulate_color")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(1, 1, 1, 1)]
}

[sub_resource type="AnimationLibrary" id="16"]
_data = {
"RESET": SubResource("12"),
"explode": SubResource("13"),
"fuming": SubResource("14"),
"idle": SubResource("15")
}

[sub_resource type="AnimationNodeAnimation" id="17"]
animation = &"explode"

[sub_resource type="AnimationNodeAnimation" id="18"]
animation = &"fuming"

[sub_resource type="AnimationNodeTimeScale" id="19"]

[sub_resource type="AnimationNodeBlendTree" id="20"]
graph_offset = Vector2(-219.187, 66.7993)
nodes/Animation/node = SubResource("18")
nodes/Animation/position = Vector2(-80, 120)
nodes/speed/node = SubResource("19")
nodes/speed/position = Vector2(100, 120)
node_connections = [&"output", 0, &"speed", &"speed", 0, &"Animation"]

[sub_resource type="AnimationNodeAnimation" id="21"]
animation = &"idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="22"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="23"]
xfade_time = 0.3
reset = false
switch_mode = 1

[sub_resource type="AnimationNodeStateMachineTransition" id="24"]

[sub_resource type="AnimationNodeStateMachine" id="25"]
states/explode/node = SubResource("17")
states/explode/position = Vector2(693, 100)
states/fuming/node = SubResource("20")
states/fuming/position = Vector2(507, 100)
states/idle/node = SubResource("21")
states/idle/position = Vector2(341, 100)
transitions = ["Start", "idle", SubResource("22"), "idle", "fuming", SubResource("23"), "fuming", "explode", SubResource("24")]
graph_offset = Vector2(25, -69)

[sub_resource type="Gradient" id="28"]
interpolation_mode = 2
offsets = PackedFloat32Array(0.0375, 0.384375, 0.69375)
colors = PackedColorArray(0.905882, 0.101961, 0, 1, 1, 0.7, 0, 1, 0.419813, 0.419813, 0.419813, 1)

[sub_resource type="GradientTexture1D" id="29"]
gradient = SubResource("28")

[sub_resource type="Curve" id="26"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.123563, 1), 0.0, 0.0, 0, 0, Vector2(0.247126, 0.488764), 0.0, 0.0, 0, 0, Vector2(0.508621, 0.474157), -0.0806847, -0.0806847, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 5

[sub_resource type="CurveTexture" id="27"]
curve = SubResource("26")

[sub_resource type="ParticleProcessMaterial" id="30"]
direction = Vector3(0, 1, 0)
spread = 180.0
initial_velocity_min = 35.76
initial_velocity_max = 39.91
gravity = Vector3(0, 0, 0)
damping_min = 58.75
damping_max = 66.34
scale_min = 8.0
scale_max = 10.0
scale_curve = SubResource("27")
color_ramp = SubResource("29")
anim_speed_min = 0.8
anim_speed_max = 1.0

[sub_resource type="QuadMesh" id="31"]

[sub_resource type="StandardMaterial3D" id="32"]
transparency = 1
shading_mode = 0
vertex_color_use_as_albedo = true
albedo_texture = ExtResource("17")
billboard_mode = 3
billboard_keep_scale = true
particles_anim_h_frames = 3
particles_anim_v_frames = 4
particles_anim_loop = false

[sub_resource type="Curve" id="37"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.281609, 1), 0.0, 0.0, 0, 0, Vector2(0.79023, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 4

[sub_resource type="CurveTexture" id="38"]
curve = SubResource("37")

[sub_resource type="Gradient" id="35"]
interpolation_mode = 2
interpolation_color_space = 1
offsets = PackedFloat32Array(0, 0.334375)
colors = PackedColorArray(0.205117, 0.205117, 0.205117, 1, 0.0295066, 0.0295066, 0.0295066, 1)

[sub_resource type="GradientTexture1D" id="36"]
gradient = SubResource("35")

[sub_resource type="Curve" id="33"]
_data = [Vector2(0.00287356, 0), 0.0, 0.0, 0, 0, Vector2(0.781609, 0.810112), 1.67471, 1.67471, 0, 0, Vector2(1, 1), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="34"]
curve = SubResource("33")

[sub_resource type="ParticleProcessMaterial" id="39"]
direction = Vector3(0, 1, 0)
spread = 48.045
initial_velocity_min = 3.4
initial_velocity_max = 5.8
gravity = Vector3(0, 16, 0)
scale_min = 19.35
scale_max = 22.15
scale_curve = SubResource("34")
color_ramp = SubResource("36")
alpha_curve = SubResource("38")
anim_speed_min = 0.4
anim_speed_max = 0.75

[node name="bomb" type="CharacterBody3D"]
collision_layer = 5
collision_mask = 3
script = ExtResource("1")
e_name = "Bomb"
deacceleration = 45.0
jtt_descent = 0.35

[node name="col" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.31338, 0)
shape = SubResource("1")

[node name="grabbable" type="Area3D" parent="." node_paths=PackedStringArray("entity")]
script = ExtResource("2")
entity = NodePath("..")
input_prompt = SubResource("2")

[node name="col" type="CollisionShape3D" parent="grabbable"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.31338, 0)
shape = SubResource("3")

[node name="hitbox" type="Area3D" parent="."]
script = ExtResource("4")
damage = 2
knockback = 40.0
tag = "bomb"
scope = 7

[node name="col" type="CollisionShape3D" parent="hitbox"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.31338, 0)
shape = SubResource("4")
disabled = true

[node name="fsm" type="Node" parent="."]
script = ExtResource("5")
initial_state = NodePath("idle")

[node name="idle" type="Node" parent="fsm"]
script = SubResource("5")

[node name="fuming" type="Node" parent="fsm"]
script = SubResource("6")

[node name="fuse_time" type="Timer" parent="fsm/fuming"]
process_callback = 0
one_shot = true

[node name="explode" type="Node" parent="fsm"]
script = SubResource("7")

[node name="sfx" type="Node3D" parent="."]

[node name="fuse" type="AudioStreamPlayer3D" parent="sfx"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.0473962, 0)
stream = ExtResource("6")
attenuation_model = 3
volume_db = -4.0
unit_size = 60.0
max_db = -4.0
max_distance = 60.0
bus = &"Sound"

[node name="strike" type="AudioStreamPlayer3D" parent="sfx"]
stream = ExtResource("7")
attenuation_model = 3
volume_db = -2.0
unit_size = 60.0
max_db = -1.0
max_distance = 60.0
bus = &"Sound"

[node name="whistle" type="AudioStreamPlayer3D" parent="sfx"]
stream = ExtResource("8")
attenuation_model = 3
volume_db = -2.0
unit_size = 90.0
max_db = -1.0
pitch_scale = 1.2
max_distance = 90.0
bus = &"Sound"

[node name="beep" type="AudioStreamPlayer3D" parent="sfx"]
stream = ExtResource("9")
attenuation_model = 3
unit_size = 60.0
max_db = -1.0
max_distance = 60.0
bus = &"SoundIndoors"

[node name="explosion" type="AudioStreamPlayer3D" parent="sfx"]
stream = SubResource("8")
attenuation_model = 3
volume_db = -4.0
unit_size = 60.0
max_db = -4.0
pitch_scale = 1.8
max_distance = 120.0
bus = &"Sound"

[node name="vis_bomb" parent="." instance=ExtResource("12")]

[node name="base" parent="vis_bomb" index="0"]
surface_material_override/0 = ExtResource("13")

[node name="spark" type="GPUParticles3D" parent="vis_bomb/stem" index="0"]
transform = Transform3D(1, 0, 5.68434e-14, 0, 1, 0, -5.68434e-14, 0, 1, -0.558962, 0.679456, 9.99502e-08)
emitting = false
amount = 1
lifetime = 0.3
local_coords = true
transform_align = 3
process_material = SubResource("9")
draw_pass_1 = SubResource("11")

[node name="anim" type="AnimationPlayer" parent="."]
process_mode = 1
libraries = {
"": SubResource("16")
}
autoplay = "idle"

[node name="tree" type="AnimationTree" parent="."]
process_mode = 1
libraries = {
"": SubResource("16")
}
tree_root = SubResource("25")
anim_player = NodePath("../anim")
parameters/fuming/speed/scale = 1.0

[node name="shadow" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
script = ExtResource("15")
size = 4.0

[node name="floor" type="RayCast3D" parent="."]
target_position = Vector3(0, -2.5, 0)
hit_from_inside = true

[node name="particle" type="Node3D" parent="."]

[node name="explosion" type="GPUParticles3D" parent="particle"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.941341, 0)
material_override = ExtResource("16")
emitting = false
amount = 24
lifetime = 0.7
one_shot = true
explosiveness = 0.2
visibility_aabb = AABB(-5.28901, -5.90607, -5.86529, 10.873, 12.2788, 11.8323)
draw_order = 1
process_material = SubResource("30")
draw_pass_1 = SubResource("31")

[node name="smoke" type="GPUParticles3D" parent="particle"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.941341, 0)
material_override = SubResource("32")
emitting = false
amount = 16
lifetime = 1.1
one_shot = true
preprocess = 0.2
explosiveness = 0.25
visibility_aabb = AABB(-5.28901, -5.90607, -5.86529, 10.873, 12.2788, 11.8323)
draw_order = 2
process_material = SubResource("39")
draw_pass_1 = SubResource("31")

[connection signal="interacted_with" from="grabbable" to="fsm/idle" method="_grabbable_interacted_with"]
[connection signal="interacted_with" from="grabbable" to="fsm/fuming" method="_grabbable_interacted_with"]
[connection signal="thrown" from="grabbable" to="fsm/fuming" method="_thrown"]
[connection signal="timeout" from="fsm/fuming/fuse_time" to="fsm/fuming" method="_fuse_timeout"]

[editable path="vis_bomb"]
