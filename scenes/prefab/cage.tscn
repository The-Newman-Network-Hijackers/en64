[gd_scene load_steps=18 format=3]

[ext_resource type="Script" path="res://scripts/cage.gd" id="1"]
[ext_resource type="Script" path="res://scripts/hurtbox.gd" id="2"]
[ext_resource type="PackedScene" path="res://asset/entity/cage/cage.blend.scn" id="3"]
[ext_resource type="Script" path="res://scripts/state_machine.gd" id="4"]
[ext_resource type="Script" path="res://scripts/cluster_spawner.gd" id="5"]
[ext_resource type="PackedScene" uid="uid://doyamm1jh5wgl" path="res://scenes/prefab/debris_stone.tscn" id="6"]
[ext_resource type="Material" uid="uid://b0rkcabokstao" path="res://asset/effect/dust/mat/vtx_dust.tres" id="7"]

[sub_resource type="CylinderShape3D" id="1"]
height = 19.207
radius = 10.547
script = null

[sub_resource type="ConcavePolygonShape3D" id="2"]
data = PackedVector3Array(0, -1, -10, 7.0711, 1, -7.0711, 0, 1, -10, 0, -1, -10, 7.0711, -1, -7.0711, 7.0711, 1, -7.0711, 7.0711, -1, -7.0711, 10, 1, 0, 7.0711, 1, -7.0711, 7.0711, -1, -7.0711, 10, -1, 0, 10, 1, 0, 10, -1, 0, 7.0711, 1, 7.0711, 10, 1, 0, 10, -1, 0, 7.0711, -1, 7.0711, 7.0711, 1, 7.0711, 7.0711, -1, 7.0711, 0, 1, 10, 7.0711, 1, 7.0711, 7.0711, -1, 7.0711, 0, -1, 10, 0, 1, 10, 0, -1, 10, -7.0711, 1, 7.0711, 0, 1, 10, 0, -1, 10, -7.0711, -1, 7.0711, -7.0711, 1, 7.0711, -7.0711, -1, 7.0711, -10, 1, 0, -7.0711, 1, 7.0711, -7.0711, -1, 7.0711, -10, -1, 0, -10, 1, 0, 0, 1, -8.3425, 5.8991, -1, -5.8991, 0, -1, -8.3425, 0, 1, -8.3425, 5.8991, 1, -5.8991, 5.8991, -1, -5.8991, -10, -1, 0, -7.0711, 1, -7.0711, -10, 1, 0, -10, -1, 0, -7.0711, -1, -7.0711, -7.0711, 1, -7.0711, -7.0711, -1, -7.0711, 0, 1, -10, -7.0711, 1, -7.0711, -7.0711, -1, -7.0711, 0, -1, -10, 0, 1, -10, 0, 1, -8.3425, 7.0711, 1, -7.0711, 5.8991, 1, -5.8991, 0, 1, -8.3425, 0, 1, -10, 7.0711, 1, -7.0711, 5.8991, 1, -5.8991, 10, 1, 0, 8.3425, 1, 0, 5.8991, 1, -5.8991, 7.0711, 1, -7.0711, 10, 1, 0, 8.3425, 1, 0, 7.0711, 1, 7.0711, 5.8991, 1, 5.8991, 8.3425, 1, 0, 10, 1, 0, 7.0711, 1, 7.0711, 5.8991, 1, 5.8991, 0, 1, 10, 0, 1, 8.3425, 5.8991, 1, 5.8991, 7.0711, 1, 7.0711, 0, 1, 10, 0, 1, 8.3425, -7.0711, 1, 7.0711, -5.8991, 1, 5.8991, 0, 1, 8.3425, 0, 1, 10, -7.0711, 1, 7.0711, -5.8991, 1, 5.8991, -10, 1, 0, -8.3425, 1, 0, -5.8991, 1, 5.8991, -7.0711, 1, 7.0711, -10, 1, 0, -8.3425, 1, 0, -7.0711, 1, -7.0711, -5.8991, 1, -5.8991, -8.3425, 1, 0, -10, 1, 0, -7.0711, 1, -7.0711, -5.8991, 1, -5.8991, 0, 1, -10, 0, 1, -8.3425, -5.8991, 1, -5.8991, -7.0711, 1, -7.0711, 0, 1, -10, -5.8991, 1, -5.8991, 0, -1, -8.3425, -5.8991, -1, -5.8991, -5.8991, 1, -5.8991, 0, 1, -8.3425, 0, -1, -8.3425, -5.8991, 1, 5.8991, -8.3425, -1, 0, -5.8991, -1, 5.8991, -5.8991, 1, 5.8991, -8.3425, 1, 0, -8.3425, -1, 0, 5.8991, 1, 5.8991, 0, -1, 8.3425, 5.8991, -1, 5.8991, 5.8991, 1, 5.8991, 0, 1, 8.3425, 0, -1, 8.3425, 5.8991, 1, -5.8991, 8.3425, -1, 0, 5.8991, -1, -5.8991, 5.8991, 1, -5.8991, 8.3425, 1, 0, 8.3425, -1, 0, -8.3425, 1, 0, -5.8991, -1, -5.8991, -8.3425, -1, 0, -8.3425, 1, 0, -5.8991, 1, -5.8991, -5.8991, -1, -5.8991, 0, 1, 8.3425, -5.8991, -1, 5.8991, 0, -1, 8.3425, 0, 1, 8.3425, -5.8991, 1, 5.8991, -5.8991, -1, 5.8991, 8.3425, 1, 0, 5.8991, -1, 5.8991, 8.3425, -1, 0, 8.3425, 1, 0, 5.8991, 1, 5.8991, 5.8991, -1, 5.8991, 5.8991, 1, -5.8991, 0, 14.8555, -8.3425, 0, 1, -8.3425, 5.8991, 1, -5.8991, 5.8991, 14.8555, -5.8991, 0, 14.8555, -8.3425, 0, 1, -8.3425, -5.8991, 14.8555, -5.8991, -5.8991, 1, -5.8991, 0, 1, -8.3425, 0, 14.8555, -8.3425, -5.8991, 14.8555, -5.8991, -8.3425, 1, 0, -5.8991, 14.8555, 5.8991, -5.8991, 1, 5.8991, -8.3425, 1, 0, -8.3425, 14.8555, 0, -5.8991, 14.8555, 5.8991, 0, 1, 8.3425, 5.8991, 14.8555, 5.8991, 5.8991, 1, 5.8991, 0, 1, 8.3425, 0, 14.8555, 8.3425, 5.8991, 14.8555, 5.8991, -5.8991, 1, -5.8991, -8.3425, 14.8555, 0, -8.3425, 1, 0, -5.8991, 1, -5.8991, -5.8991, 14.8555, -5.8991, -8.3425, 14.8555, 0, -5.8991, 1, 5.8991, 0, 14.8555, 8.3425, 0, 1, 8.3425, -5.8991, 1, 5.8991, -5.8991, 14.8555, 5.8991, 0, 14.8555, 8.3425, 5.8991, 1, 5.8991, 8.3425, 14.8555, 0, 8.3425, 1, 0, 5.8991, 1, 5.8991, 5.8991, 14.8555, 5.8991, 8.3425, 14.8555, 0, 8.3425, 1, 0, 5.8991, 14.8555, -5.8991, 5.8991, 1, -5.8991, 8.3425, 1, 0, 8.3425, 14.8555, 0, 5.8991, 14.8555, -5.8991, -7.0711, -1, -7.0711, 7.0711, -1, -7.0711, 0, -1, -10, 7.0711, -1, -7.0711, 7.0711, -1, 7.0711, 10, -1, 0, 7.0711, -1, 7.0711, -7.0711, -1, 7.0711, 0, -1, 10, -7.0711, -1, 7.0711, -7.0711, -1, -7.0711, -10, -1, 0, -7.0711, -1, -7.0711, 7.0711, -1, 7.0711, 7.0711, -1, -7.0711, 7.0711, -1, 7.0711, -7.0711, -1, -7.0711, -7.0711, -1, 7.0711, 0, 14.5417, -10.0965, 10.0965, 14.5417, 0, 7.1393, 14.5417, -7.1393, 10.0965, 14.5417, 0, 0, 14.5417, 10.0965, 7.1393, 14.5417, 7.1393, 0, 14.5417, 10.0965, -10.0965, 14.5417, 0, -7.1393, 14.5417, 7.1393, -10.0965, 14.5417, 0, 0, 14.5417, -10.0965, -7.1393, 14.5417, -7.1393, 0, 14.5417, -10.0965, 0, 14.5417, 10.0965, 10.0965, 14.5417, 0, 0, 14.5417, 10.0965, 0, 14.5417, -10.0965, -10.0965, 14.5417, 0, -7.1393, 14.5417, -7.1393, -8.1682, 17.8237, 0, -10.0965, 14.5417, 0, -7.1393, 14.5417, -7.1393, -5.7758, 17.8237, -5.7758, -8.1682, 17.8237, 0, -7.1393, 14.5417, 7.1393, 0, 17.8237, 8.1682, 0, 14.5417, 10.0965, -7.1393, 14.5417, 7.1393, -5.7758, 17.8237, 5.7758, 0, 17.8237, 8.1682, 10.0965, 14.5417, 0, 5.7758, 17.8237, -5.7758, 7.1393, 14.5417, -7.1393, 10.0965, 14.5417, 0, 8.1682, 17.8237, 0, 5.7758, 17.8237, -5.7758, 0, 14.5417, -10.0965, -5.7758, 17.8237, -5.7758, -7.1393, 14.5417, -7.1393, 0, 14.5417, -10.0965, 0, 17.8237, -8.1682, -5.7758, 17.8237, -5.7758, -10.0965, 14.5417, 0, -5.7758, 17.8237, 5.7758, -7.1393, 14.5417, 7.1393, -10.0965, 14.5417, 0, -8.1682, 17.8237, 0, -5.7758, 17.8237, 5.7758, 0, 14.5417, 10.0965, 5.7758, 17.8237, 5.7758, 7.1393, 14.5417, 7.1393, 0, 14.5417, 10.0965, 0, 17.8237, 8.1682, 5.7758, 17.8237, 5.7758, 7.1393, 14.5417, -7.1393, 0, 17.8237, -8.1682, 0, 14.5417, -10.0965, 7.1393, 14.5417, -7.1393, 5.7758, 17.8237, -5.7758, 0, 17.8237, -8.1682, 7.1393, 14.5417, 7.1393, 8.1682, 17.8237, 0, 10.0965, 14.5417, 0, 7.1393, 14.5417, 7.1393, 5.7758, 17.8237, 5.7758, 8.1682, 17.8237, 0, -5.7758, 17.8237, 5.7758, 0, 18.9975, 0, 0, 17.8237, 8.1682, 8.1682, 17.8237, 0, 0, 18.9975, 0, 5.7758, 17.8237, -5.7758, -8.1682, 17.8237, 0, 0, 18.9975, 0, -5.7758, 17.8237, 5.7758, 0, 17.8237, -8.1682, 0, 18.9975, 0, -5.7758, 17.8237, -5.7758, 5.7758, 17.8237, -5.7758, 0, 18.9975, 0, 0, 17.8237, -8.1682, 0, 17.8237, 8.1682, 0, 18.9975, 0, 5.7758, 17.8237, 5.7758, 5.7758, 17.8237, 5.7758, 0, 18.9975, 0, 8.1682, 17.8237, 0, -5.7758, 17.8237, -5.7758, 0, 18.9975, 0, -8.1682, 17.8237, 0, 5.8991, 1, -5.8991, -5.8991, 1, -5.8991, 0, 1, -8.3425, -5.8991, 1, -5.8991, -5.8991, 1, 5.8991, -8.3425, 1, 0, -5.8991, 1, 5.8991, 5.8991, 1, 5.8991, 0, 1, 8.3425, 5.8991, 1, 5.8991, 5.8991, 1, -5.8991, 8.3425, 1, 0, 5.8991, 1, -5.8991, -5.8991, 1, 5.8991, -5.8991, 1, -5.8991, -5.8991, 1, 5.8991, 5.8991, 1, -5.8991, 5.8991, 1, 5.8991)
script = null

[sub_resource type="GDScript" id="3"]
resource_name = "cage_idle"
script/source = "# cage_idle.gd
extends State

'''
Cage => Idle state
'''

func _on_damaged(health: int, packet: Dictionary) -> void:
	if state_machine.state != self:
		return
	state_machine.transition_state(\"broken\")
"

[sub_resource type="GDScript" id="4"]
resource_name = "cage_broken"
script/source = "# cage_broken.gd
extends State

'''
Cage => Broken state
'''

func _enter(_msg := {}) -> void:
	owner.get_node(\"cage\").queue_free()
	owner.get_node(\"col\").queue_free()
	owner.get_node(\"dust\").restart()
	owner.get_node(\"stone_debris\").spawn()
	owner.get_node(\"stone_debris\").tree_exited.connect(func(): owner.queue_free())
"

[sub_resource type="Curve" id="5"]
_data = [Vector2(0, 1), 0.0, 3.32432, 0, 0, Vector2(0.290323, 1), -1.93347, -1.93347, 0, 0, Vector2(1, 0.506757), 0.0, 0.0, 0, 0]
point_count = 3
script = null

[sub_resource type="CurveTexture" id="6"]
curve = SubResource( "5" )
script = null

[sub_resource type="Curve" id="7"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.365591, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3
script = null

[sub_resource type="CurveTexture" id="8"]
curve = SubResource( "7" )
script = null

[sub_resource type="ParticleProcessMaterial" id="9"]
direction = Vector3(0, 1, 0)
spread = 180.0
initial_velocity_min = 4.0
initial_velocity_max = 6.0
gravity = Vector3(0, 0, 0)
radial_accel_min = 11.0
radial_accel_max = 17.0
damping_min = 2.175
damping_max = 2.175
scale_max = 2.0
scale_curve = SubResource( "6" )
alpha_curve = SubResource( "8" )
anim_speed_min = 1.0
anim_speed_max = 1.4
script = null

[sub_resource type="QuadMesh" id="10"]
size = Vector2(3, 3)
script = null

[node name="cage" type="StaticBody3D"]
script = ExtResource( "1" )

[node name="hurtbox" type="Area3D" parent="."]
script = ExtResource( "2" )
max_health = 2
tags = ["bomb"]
scope = 1

[node name="col" type="CollisionShape3D" parent="hurtbox"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 9.15843, 0)
shape = SubResource( "1" )

[node name="col" type="CollisionShape3D" parent="."]
shape = SubResource( "2" )

[node name="cage" parent="." instance=ExtResource( "3" )]

[node name="fsm" type="Node" parent="."]
script = ExtResource( "4" )
initial_state = NodePath("idle")

[node name="idle" type="Node" parent="fsm"]
script = SubResource( "3" )

[node name="broken" type="Node" parent="fsm"]
script = SubResource( "4" )

[node name="stone_debris" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 16.1377, 0)
top_level = true
script = ExtResource( "5" )
scene = ExtResource( "6" )
spawn_count = 8
fs_variance = Vector2(50, 75)
yv_variance = Vector2(50, 85)
one_shot = true

[node name="dust" type="GPUParticles3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 9.92028, 0)
material_override = ExtResource( "7" )
cast_shadow = 0
emitting = false
lifetime = 1.5
one_shot = true
speed_scale = 1.5
explosiveness = 1.0
visibility_aabb = AABB(-36.9484, -22.9961, -31.3639, 73.5459, 39.3282, 69.0008)
process_material = SubResource( "9" )
draw_pass_1 = SubResource( "10" )

[connection signal="damaged" from="hurtbox" to="fsm/idle" method="_on_damaged"]
[connection signal="tree_exiting" from="cage" to="." method="_cage_tree_exiting"]

[editable path="cage"]
